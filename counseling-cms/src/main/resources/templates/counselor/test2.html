<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Calendar with Appointments</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .calendar {
            width: 100%;
            max-width: 800px;
            margin: auto;
            padding: 20px;
            text-align: center;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-header-left {
            display: flex;
            align-items: center;
        }
        .calendar-header-right {
            display: flex;
            align-items: center;
        }
        .calendar-buttons button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin: 0 5px;
        }
        .calendar-title {
            font-size: 18px;
            font-weight: bold;
        }
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* 모든 열의 넓이를 같게 설정 */
        }
        .calendar-table th, .calendar-table td {
            border: 1px solid #ddd;
            padding: 4px;
            vertical-align: top;
            min-height: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap; /* 텍스트가 한 줄로 유지되도록 설정 */
        }
        .calendar-table th {
            background-color: #f4f4f4;
        }
        .appointment {
            margin: 2px 0;
            padding: 2px;
            border-radius: 3px;
            color: white;
            text-align: left;
            font-size: 12px; /* 글자 크기를 줄여서 한 줄로 표시되도록 설정 */
        }
        .appointment-time, .appointment-name {
            display: block;
        }
        .appointment-type {
            display: block;
            margin-top: 2px;
        }
        .today {
 		   background-color: #f0f0f0; /* 연한 회색 */
    		font-weight: bold;
		}
		
    </style>
</head>
<body>
    <div class="calendar">
        <div class="calendar-header">
            <div class="calendar-header-left">
                <button onclick="moveWeek(-1)" class="calendar-buttons" style="margin-right: 5px;">&lt;</button>
                <div class="calendar-title" id="week-title"></div>
                <button onclick="moveWeek(1)" class="calendar-buttons" style="margin-left: 5px;">&gt;</button>
            </div>
            <div class="calendar-header-right">
                <button onclick="viewWeekly()" class="calendar-buttons">주간</button>
                <button onclick="viewMonthly()" class="calendar-buttons">월간</button>
            </div>
        </div>
        <table class="calendar-table">
            <thead>
                <tr id="day-headers">
                    <!-- 월/일(요일) 형식의 날짜가 여기에 표시됩니다 -->
                </tr>
            </thead>
            <tbody>
                <tr id="appointments">
                    <!-- 상담이 여기에 표시됩니다 -->
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        let currentDate = new Date();
        let currentWeek = 0;
        const studentColors = {};

        function getInitialWeek() {
            const firstDayOfCurrentMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const dayOfWeek = firstDayOfCurrentMonth.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            const firstMondayOfMonth = new Date(firstDayOfCurrentMonth);
            firstMondayOfMonth.setDate(firstDayOfCurrentMonth.getDate() + diff);
            const today = new Date();
            const daysFromFirstMonday = Math.floor((today - firstMondayOfMonth) / (24 * 60 * 60 * 1000));
            currentWeek = Math.floor(daysFromFirstMonday / 7);
        }

        function updateCalendar() {
            const firstDayOfWeek = getFirstDayOfWeek(currentDate, currentWeek);
            const dayHeaders = document.getElementById('day-headers');
            const appointmentsRow = document.getElementById('appointments');
            const weekTitle = document.getElementById('week-title');

            dayHeaders.innerHTML = '';
            appointmentsRow.innerHTML = '';

            const daysOfWeek = ['일', '월', '화', '수', '목', '금', '토'];
            const today = new Date().toISOString().split('T')[0]; // 오늘 날짜를 YYYY-MM-DD 형식으로
            let todayIndex = null;

            for (let i = 0; i < 7; i++) {
                const date = new Date(firstDayOfWeek);
                date.setDate(date.getDate() + i);
                const month = date.getMonth() + 1; // 월 (0부터 시작하므로 +1)
                const day = date.getDate(); // 일
                const dayOfWeek = daysOfWeek[date.getDay()]; // 요일
                const dateStr = date.toISOString().split('T')[0]; // YYYY-MM-DD 형식
                if (dateStr === today) {
                    todayIndex = i; // 오늘 날짜의 인덱스를 저장
                }
                dayHeaders.innerHTML += `<th>${month}/${day}(${dayOfWeek})</th>`;
            }

            const appointments = getAppointmentsForWeek(firstDayOfWeek);
            for (let i = 0; i < 7; i++) {
                const date = new Date(firstDayOfWeek);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dailyAppointments = appointments[dateStr] || [];
                // 시간별로 정렬
                const sortedAppointments = dailyAppointments
                    .sort((a, b) => a.time.localeCompare(b.time));
                const appointmentHtml = sortedAppointments
                    .map(appointment => {
                        const color = getStudentColor(appointment.name);
                        return `
                            <div class="appointment" style="background-color: ${color}">
                                <span class="appointment-time">${appointment.time}</span>
                                <span class="appointment-name">${appointment.name}</span>
                                <span class="appointment-type">${appointment.type}</span>
                            </div>
                        `;
                    }).join(''); // 각 일정이 다른 줄에 표시되도록
                
                appointmentsRow.innerHTML += `<td class="${todayIndex === i ? 'today' : ''}">${appointmentHtml}</td>`;
            }

            const monthName = firstDayOfWeek.toLocaleString('default', { month: 'long' });
            const weekNumber = getWeekNumber(firstDayOfWeek);
            weekTitle.textContent = `${monthName} ${weekNumber}째 주`;
        }



        function getFirstDayOfWeek(date, weekOffset) {
            const firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);
            const dayOfWeek = firstDayOfMonth.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            const firstMonday = new Date(firstDayOfMonth);
            firstMonday.setDate(firstDayOfMonth.getDate() + diff);
            return new Date(firstMonday.setDate(firstMonday.getDate() + (weekOffset * 7)));
        }

        function getWeekNumber(date) {
            const firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);
            const dayOfWeek = firstDayOfMonth.getDay();
            const daysFromStart = Math.floor((date - firstDayOfMonth) / (24 * 60 * 60 * 1000));
            return Math.ceil((daysFromStart + firstDayOfMonth.getDay() + 1) / 7);
        }

        function moveWeek(offset) {
            currentWeek += offset;
            updateCalendar();
        }

        function viewWeekly() {
            alert('주간 보기');
            // 주간 보기 모드로 전환하는 로직을 여기에 추가합니다.
        }

        function viewMonthly() {
            alert('월간 보기');
            // 월간 보기 모드로 전환하는 로직을 여기에 추가합니다.
        }

        function getAppointmentsForWeek(startDate) {
            const appointments = {
                '2024-09-01': [
                    { time: '09:00', type: '개인 상담', name: '학생 A' },
                    { time: '14:00', type: '그룹 상담', name: '학생 B' }
                ],
                '2024-09-02': [
                    { time: '10:00', type: '개인 상담', name: '학생 C' }
                ],
                '2024-09-03': [
                    { time: '11:00', type: '개인 상담', name: '학생 A' }
                ],
                // 추가 날짜 데이터...
            };
            return appointments;
        }

        function getStudentColor(studentName) {
            if (!studentColors[studentName]) {
                studentColors[studentName] = getRandomColor();
            }
            return studentColors[studentName];
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        getInitialWeek();
        updateCalendar();
    </script>
</body>
</html>
